<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Health Suggestions API Tester</title>
    <!-- Using Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen py-12">

    <div class="w-full max-w-lg p-8 space-y-6 bg-white rounded-xl shadow-lg">
        <div class="text-center">
            <h1 class="text-3xl font-bold text-gray-800">Health AI Suggestions</h1>
            <p class="mt-2 text-gray-600">Enter your health data to get AI-powered feedback.</p>
        </div>

        <!-- Form for user input -->
        <form id="healthForm" class="space-y-6">
            <div>
                <label for="heartRate" class="text-sm font-medium text-gray-700">Heart Rate (bpm)</label>
                <input type="number" id="heartRate" name="heartRate" value="75" class="mt-1 block w-full px-4 py-2 text-gray-900 bg-gray-50 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500" placeholder="e.g., 75" required>
            </div>

            <div>
                <label for="temperature" class="text-sm font-medium text-gray-700">Temperature (Â°F)</label>
                <input type="number" id="temperature" name="temperature" step="0.1" value="98.6" class="mt-1 block w-full px-4 py-2 text-gray-900 bg-gray-50 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500" placeholder="e.g., 98.6" required>
            </div>

            <div>
                <button type="submit" id="submitButton" class="w-full px-4 py-2.5 text-white bg-blue-600 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-4 focus:ring-blue-300 font-medium transition duration-150 ease-in-out flex items-center justify-center">
                    Get Suggestions
                </button>
            </div>
        </form>

        <!-- Loading indicator -->
        <div id="loadingIndicator" class="hidden text-center">
             <div class="flex justify-center items-center">
                <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
                <p class="text-gray-600 ml-3">Fetching suggestions...</p>
             </div>
        </div>
        
        <!-- Section to display the API response in a structured UI -->
        <div id="responseSection" class="hidden space-y-4 pt-4">
            <!-- Good Sign Card -->
            <div class="flex items-start p-4 bg-green-50 border border-green-200 rounded-lg">
                <div class="flex-shrink-0">
                    <svg class="w-6 h-6 text-green-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                </div>
                <div class="ml-3">
                    <h3 class="font-semibold text-green-800">Good Signs</h3>
                    <p id="goodSignText" class="mt-1 text-sm text-green-700"></p>
                </div>
            </div>

            <!-- Bad Sign Card -->
            <div class="flex items-start p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
                <div class="flex-shrink-0">
                    <svg class="w-6 h-6 text-yellow-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126z" />
                    </svg>
                </div>
                <div class="ml-3">
                    <h3 class="font-semibold text-yellow-800">Potential Concerns</h3>
                    <p id="badSignText" class="mt-1 text-sm text-yellow-700"></p>
                </div>
            </div>

            <!-- Improvement Suggestion Card -->
            <div class="flex items-start p-4 bg-blue-50 border border-blue-200 rounded-lg">
                <div class="flex-shrink-0">
                    <svg class="w-6 h-6 text-blue-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 18v-5.25m0 0a6.01 6.01 0 001.5-.189m-1.5.189a6.01 6.01 0 01-1.5-.189m3.75 7.478a12.06 12.06 0 01-4.5 0m3.75 2.311a7.5 7.5 0 01-7.5 0c-1.421-.482-1.421-2.342 0-2.824M8.25 18.25a7.5 7.5 0 015.25-2.186" />
                    </svg>
                </div>
                <div class="ml-3">
                    <h3 class="font-semibold text-blue-800">Improvement Suggestions</h3>
                    <p id="improvementSuggestionText" class="mt-1 text-sm text-blue-700"></p>
                </div>
            </div>
        </div>

        <!-- Error message display -->
        <div id="errorDisplay" class="hidden p-4 bg-red-100 text-red-700 rounded-md"></div>
    </div>

    <script>
        // --- Get references to DOM elements ---
        const healthForm = document.getElementById('healthForm');
        const submitButton = document.getElementById('submitButton');
        const responseSection = document.getElementById('responseSection');
        const loadingIndicator = document.getElementById('loadingIndicator');
        const errorDisplay = document.getElementById('errorDisplay');
        
        // Response text elements
        const goodSignText = document.getElementById('goodSignText');
        const badSignText = document.getElementById('badSignText');
        const improvementSuggestionText = document.getElementById('improvementSuggestionText');

        // --- Add event listener to the form ---
        healthForm.addEventListener('submit', async (event) => {
            // Prevent the default form submission behavior
            event.preventDefault();

            // --- UI updates for loading state ---
            submitButton.disabled = true;
            responseSection.classList.add('hidden');
            errorDisplay.classList.add('hidden');
            loadingIndicator.classList.remove('hidden');

            // --- Get data from the form ---
            const heartRate = document.getElementById('heartRate').value;
            const temperature = document.getElementById('temperature').value;
            
            const requestBody = {
                heartRate: heartRate,
                temperature: temperature
            };

            // --- Call the API using Fetch ---
            try {
                const response = await fetch('http://localhost:3000/getSuggestions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestBody)
                });

                // Check if the response is successful
                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({ error: 'Failed to parse error response.' }));
                    throw new Error(errorData.error || `HTTP error! Status: ${response.status}`);
                }

                // Parse the JSON response from the API
                const data = await response.json();

                // --- Display the response in the new UI cards ---
                goodSignText.textContent = data.goodSign || 'No information provided.';
                badSignText.textContent = data.badSign || 'No information provided.';
                improvementSuggestionText.textContent = data.improvementSuggestion || 'No information provided.';
                
                responseSection.classList.remove('hidden');

            } catch (error) {
                // --- Display any errors that occur ---
                console.error('Fetch error:', error);
                errorDisplay.textContent = `Error: ${error.message}. Make sure the Node.js server is running and accessible.`;
                errorDisplay.classList.remove('hidden');
            } finally {
                // --- Reset UI from loading state ---
                loadingIndicator.classList.add('hidden');
                submitButton.disabled = false;
            }
        });
    </script>

</body>
</html>
